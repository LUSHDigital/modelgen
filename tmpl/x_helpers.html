{{define "helpers"}}
package {{ .PackageName }}

/*---------------------------+
| Code generated by modelgen |
|        DO NOT EDIT.        |
+---------------------------*/

import (
	"database/sql"
	"database/sql/driver"
	"encoding/json"
	"fmt"
	"reflect"
	"strconv"
	"strings"
	"time"

	"github.com/go-sql-driver/mysql"
)

// StdTime provides default SQL TIME format
const StdTime = "15:04:05"

// emptyTime allows default times to be considered
// null for insertion into the database.
var emptyTime = time.Time{}

/*-------------+
| Type aliases |
+-------------*/

// NullFloat64 aliases sql.NullFloat64
type NullFloat64 sql.NullFloat64

// NullString aliases sql.NullString
type NullString sql.NullString

// NullBool aliases sql.NullBool
type NullBool sql.NullBool

// NullInt64 aliases sql.NullInt64
type NullInt64 sql.NullInt64

// NullTime aliases sql.NullTime
type NullTime mysql.NullTime

// RawJSON aliases json.RawMessage
type RawJSON json.RawMessage

// StringArray aliases []string
type StringArray []string

// IntArray aliases []int64
type IntArray []int64

// FloatArray aliases []float64
type FloatArray []float64

/*---------------------------+
| NullString implementations |
+---------------------------*/

// MarshalJSON for NullString
func (n NullString) MarshalJSON() ([]byte, error) {
	var a *string
	if n.Valid {
		a = &n.String
	}
	return json.Marshal(a)
}

// UnmarshalJSON for NullString
func (n *NullString) UnmarshalJSON(b []byte) error {
	err := json.Unmarshal(b, &n.String)
	n.Valid = err == nil
	return err
}

// Value for NullString
func (n NullString) Value() (driver.Value, error) {
	if !n.Valid {
		return nil, nil
	}
	return n.String, nil
}

// Scan for NullString
func (n *NullString) Scan(src interface{}) error {
	var a sql.NullString
	if err := a.Scan(src); err != nil {
		return err
	}
	n.String = a.String
	if reflect.TypeOf(src) != nil {
		n.Valid = true
	}
	return nil
}

/*----------------------------+
| NullFloat64 implementations |
+----------------------------*/

// MarshalJSON for NullFloat64
func (n NullFloat64) MarshalJSON() ([]byte, error) {
	var a *float64
	if n.Valid {
		a = &n.Float64
	}
	return json.Marshal(a)
}

// Value for NullFloat64
func (n NullFloat64) Value() (driver.Value, error) {
	if !n.Valid {
		return nil, nil
	}
	return n.Float64, nil
}

// UnmarshalJSON for NullFloat64
func (n *NullFloat64) UnmarshalJSON(b []byte) error {
	err := json.Unmarshal(b, &n.Float64)
	n.Valid = err == nil
	return err
}

// Scan for NullFloat64
func (n *NullFloat64) Scan(src interface{}) error {
	var a sql.NullFloat64
	if err := a.Scan(src); err != nil {
		return err
	}
	n.Float64 = a.Float64
	if reflect.TypeOf(src) != nil {
		n.Valid = true
	}
	return nil
}

/*--------------------------+
| NullInt64 implementations |
+--------------------------*/

// MarshalJSON for NullInt64
func (n NullInt64) MarshalJSON() ([]byte, error) {
	var a *int64
	if n.Valid {
		a = &n.Int64
	}
	return json.Marshal(a)
}

// Value for NullInt64
func (n NullInt64) Value() (driver.Value, error) {
	if !n.Valid {
		return nil, nil
	}
	return n.Int64, nil
}

// UnmarshalJSON for NullInt64
func (n *NullInt64) UnmarshalJSON(b []byte) error {
	err := json.Unmarshal(b, &n.Int64)
	n.Valid = err == nil
	return err
}

// Scan for NullInt64
func (n *NullInt64) Scan(src interface{}) error {
	var a sql.NullInt64
	if err := a.Scan(src); err != nil {
		return err
	}
	n.Int64 = a.Int64
	if reflect.TypeOf(src) != nil {
		n.Valid = true
	}
	return nil
}

/*-------------------------+
| NullBool implementations |
+-------------------------*/

// MarshalJSON for NullBool
func (n NullBool) MarshalJSON() ([]byte, error) {
	var a *bool
	if n.Valid {
		a = &n.Bool
	}
	return json.Marshal(a)
}

// Value for NullBool
func (n NullBool) Value() (driver.Value, error) {
	if !n.Valid {
		return nil, nil
	}
	return n.Bool, nil
}

// UnmarshalJSON for NullBool
func (n *NullBool) UnmarshalJSON(b []byte) error {
	var field *bool
	err := json.Unmarshal(b, &field)
	if field != nil {
		n.Valid = true
		n.Bool = *field
	}
	return err
}

// Scan for NullBool
func (n *NullBool) Scan(src interface{}) error {
	var a sql.NullBool
	if err := a.Scan(src); err != nil {
		return err
	}
	n.Bool = a.Bool
	if reflect.TypeOf(src) != nil {
		n.Valid = true
	}
	return nil
}

/*-------------------------+
| NullTime implementations |
+-------------------------*/

// MarshalJSON for NullTime
func (n NullTime) MarshalJSON() ([]byte, error) {
	var a *time.Time
	if n.Valid {
		a = &n.Time
	}
	return json.Marshal(a)
}

// Value for NullTime
func (n NullTime) Value() (driver.Value, error) {
	if !n.Valid {
		return nil, nil
	}
	return n.Time, nil
}

// UnmarshalJSON for NullTime
func (n *NullTime) UnmarshalJSON(b []byte) error {
	s := string(b)
	s = strings.Trim(s, `"`)
	tim, err := time.Parse(time.RFC3339, s)
	if err != nil {
		n.Valid = false
		return err
	}

	n.Time = tim
	n.Valid = true
	return nil
}

// Scan for NullTime
func (n *NullTime) Scan(src interface{}) error {
	// Set initial state for subsequent scans.
	n.Valid = false

	var a mysql.NullTime
	if err := a.Scan(src); err != nil {
		return err
	}
	n.Time = a.Time
	if reflect.TypeOf(src) != nil {
		n.Valid = true
	}
	return nil
}

/*------------------------+
| RawJSON implementations |
+------------------------*/

// MarshalJSON for NullString
func (n RawJSON) MarshalJSON() ([]byte, error) {
	a := json.RawMessage(n)
	return a.MarshalJSON()
}

// Value for NullString
func (n RawJSON) Value() (driver.Value, error) {
	return string(n), nil
}

// UnmarshalJSON for NullString
func (n *RawJSON) UnmarshalJSON(b []byte) error {
	var a json.RawMessage
	json.Unmarshal(b, &a)
	c := RawJSON(a)
	*n = c
	return nil
}

// Scan for NullString
func (n *RawJSON) Scan(src interface{}) error {
	var a sql.NullString
	if err := a.Scan(src); err != nil {
		return err
	}
	jsn := RawJSON([]byte(a.String))
	*n = jsn
	return nil
}

/******************************
* StringArray implementations *
******************************/

// MarshalJSON marshals a StringArray into JSON.
func (n StringArray) MarshalJSON() ([]byte, error) {
	return json.Marshal([]string(n))
}

// UnmarshalJSON unmarshals JSON into a StringArray.
func (n *StringArray) UnmarshalJSON(b []byte) error {
	var raw []string
	if err := json.Unmarshal(b, &raw); err != nil {
		return err
	}

	*n = StringArray(raw)
	return nil
}

// Value is used when writing data into the database.
func (n StringArray) Value() (driver.Value, error) {
	return "{" + strings.Join(n, ",") + "}", nil
}

// Scan is used when reading data from the database.
func (n *StringArray) Scan(src interface{}) error {
	if src == nil {
		return nil
	}

	rawBytes, ok := src.([]byte)
	if !ok {
		return fmt.Errorf("expected []byte in StringArray.Scan but got %T", src)
	}

	raw := strings.Trim(string(rawBytes), "{} ")
	parts := strings.Split(raw, ",")
	for _, part := range parts {
		*n = append(*n, strings.Trim(part, `" `))
	}

	return nil
}

/***************************
* IntArray implementations *
***************************/

// MarshalJSON marshals a IntArray into JSON.
func (n IntArray) MarshalJSON() ([]byte, error) {
	return json.Marshal([]int64(n))
}

// UnmarshalJSON unmarshals JSON into a IntArray.
func (n *IntArray) UnmarshalJSON(b []byte) error {
	var raw []int64
	if err := json.Unmarshal(b, &raw); err != nil {
		return err
	}

	*n = IntArray(raw)
	return nil
}

// Value is used when writing data into the database.
func (n IntArray) Value() (driver.Value, error) {
	return "{" + strings.Trim(strings.Join(strings.Fields(fmt.Sprint(n)), ","), "[]") + "}", nil
}

// Scan is used when reading data from the database.
func (n *IntArray) Scan(src interface{}) error {
	if src == nil {
		return nil
	}

	rawBytes, ok := src.([]byte)
	if !ok {
		return fmt.Errorf("expected []byte in IntArray.Scan but got %T", src)
	}

	raw := strings.Trim(string(rawBytes), "{} ")
	parts := strings.Split(raw, ",")
	for _, part := range parts {
		i, err := strconv.ParseInt(strings.Trim(part, ` `), 10, 64)
		if err != nil {
			return err
		}
		*n = append(*n, i)
	}

	return nil
}

/***************************
* FloatArray implementations *
***************************/

// MarshalJSON marshals a FloatArray into JSON.
func (n FloatArray) MarshalJSON() ([]byte, error) {
	return json.Marshal([]float64(n))
}

// UnmarshalJSON unmarshals JSON into a FloatArray.
func (n *FloatArray) UnmarshalJSON(b []byte) error {
	var raw []float64
	if err := json.Unmarshal(b, &raw); err != nil {
		return err
	}

	*n = FloatArray(raw)
	return nil
}

// Value is used when writing data into the database.
func (n FloatArray) Value() (driver.Value, error) {
	return "{" + strings.Trim(strings.Join(strings.Fields(fmt.Sprint(n)), ","), "[]") + "}", nil
}

// Scan is used when reading data from the database.
func (n *FloatArray) Scan(src interface{}) error {
	if src == nil {
		return nil
	}

	rawBytes, ok := src.([]byte)
	if !ok {
		return fmt.Errorf("expected []byte in FloatArray.Scan but got %T", src)
	}

	raw := strings.Trim(string(rawBytes), "{} ")
	parts := strings.Split(raw, ",")
	for _, part := range parts {
		f, err := strconv.ParseFloat(strings.Trim(part, ` `), 64)
		if err != nil {
			return err
		}
		*n = append(*n, f)
	}

	return nil
}

/*-----------------+
| Helper functions |
+-----------------*/

// ToNullString returns a new NullString
func ToNullString(s *string) NullString {
	if s == nil {
		return NullString(sql.NullString{Valid: false})
	}
	return NullString(sql.NullString{String: *s, Valid: true})
}

// ToNullInt64 returns a new NullInt64
func ToNullInt64(i *int64) NullInt64 {
	if i == nil {
		return NullInt64(sql.NullInt64{Valid: false})
	}
	return NullInt64(sql.NullInt64{Int64: *i, Valid: true})
}

// ToNullFloat64 returns a new NullFloat64
func ToNullFloat64(i *float64) NullFloat64 {
	if i == nil {
		return NullFloat64(sql.NullFloat64{Valid: false})
	}
	return NullFloat64(sql.NullFloat64{Float64: *i, Valid: true})
}

// ToNullBool creates a new NullBool
func ToNullBool(b *bool) NullBool {
	if b == nil {
		return NullBool(sql.NullBool{Valid: false})
	}
	return NullBool(sql.NullBool{Bool: *b, Valid: true})
}

// ToNullTime creates a new NullTime
func ToNullTime(t time.Time) NullTime {
	if t == emptyTime {
		return NullTime(mysql.NullTime{Valid: false})
	}
	return NullTime(mysql.NullTime{Time: t, Valid: true})
}
{{end}}
